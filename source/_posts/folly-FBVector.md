---
title: folly-FBVector
category:
  - c++
tags:
  - c++
  - folly
date: 2021-12-04 23:53:57
---

上次研究了folly的FBString，还是有很多体会的，这次来研究下folly的FBVector。

<!-- more -->

## 1.简介

std::vector的实现很简单，就是个可以动态扩展的数组，而FBVector在介绍中，号称当你将项目中的std::vector替换成folly:fbstring在所有情况下都不会有性能上的副作用，绝大多数情况都是能提升性能的，而且某些时候提升的会很可观。

##2.特性

### i.内存处理策略

std::vector在push_back的时候如果容量不足，会重新申请内存，而重新申请内存时扩大的系数是2。这会导致每次申请的新内存永远比之前每次扩大前的原内存大小之和更大，因为：

```
1 + 2^^1 + 2^^2 + 2^^3... + 2^^n = 2^^(n+1) - 1 < 2^^(n+1)
```

因此导致新申请的内存没法重新利用之前申请过的内存块，只能新开辟一块。
